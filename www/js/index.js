function b(h){function O(A){A.stopPropagation();const{offsetX:N,offsetY:R}=A,F=Math.min(Math.floor(N/h.ui.cellSize),8),W=Math.min(Math.floor(R/h.ui.cellSize),8),X=h.getSelectedCell();if(X===null||X[0]!==F||X[1]!==W)h.setSelectedCell([F,W]),h.refreshGrid()}function q(A){if(A.stopPropagation(),h.getSelectedCell()!==null)h.setSelectedCell(null),h.refreshGrid()}function B(A){if(A.stopPropagation(),A.key>="1"&&A.key<="9"&&h.getSelectedCell()!==null){const N=parseInt(A.key);if(N%1===0)h.toggle(N)}}h.canvas.addEventListener("mousemove",O),h.canvas.addEventListener("mouseout",q),document.onkeyup=B}class L{h;O;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(h){if(L._uis.has(h))return L._uis.get(h);const O=h.getContext("2d");if(O===null)return!1;const q=new L(h,O);return L._uis.set(h,q),q}_cellSize;constructor(h,O){this._canvas=h;this._ctx=O;this._cellSize=Math.round(Math.min(h.width,h.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=L.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(h,O,q=this._cellSize,B=L.thinLineColor,A){const N=h*q,R=O*q;if(A)this._ctx.fillStyle=A,this._ctx.fillRect(N+1,R+1,q-2,q-2);return this._ctx.strokeStyle=B,this._ctx.strokeRect(N,R,q,q),this}drawRow(h,O){for(let q=0;q<9;q++)this.drawCell(q,h,this._cellSize,L.thinLineColor,O);return this}drawColumn(h,O){for(let q=0;q<9;q++)this.drawCell(h,q,this._cellSize,L.thinLineColor,O);return this}drawGroup(h,O,q){this.drawCell(h,O,this._cellSize*3,L.boldLineColor,q);for(let B=0;B<3;B++)for(let A=0;A<3;A++)this.drawCell(h*3+A,O*3+B,this._cellSize,L.thinLineColor);return this}drawCellValue(h,O,q){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const B=h*this._cellSize+Math.floor(this._cellSize*0.5),A=O*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(q.toString(),B,A),this}drawCellDomain(h,O,q){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const B=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),A=Math.floor(B/3),N=Math.max(1,Math.floor(this._cellSize*0.1)),R=h*this._cellSize+N,F=O*this._cellSize+N;for(let W=1;W<=9;W++){const X=q.has(W)?W:null,M=(W-1)%3,P=Math.floor((W-1)/3),E=R+A*M,K=F+A*P;this._ctx.fillText(X!==null?X.toString():"",E,K)}return this}drawEmptyGrid(){this.clearCanvas();for(let h=0;h<3;h++)for(let O=0;O<3;O++)this.drawGroup(O,h);return this}colorizeSelectedStuff(h){if(h===null)return this;const O=[Math.floor(h[0]/3),Math.floor(h[1]/3)];return this.drawRow(h[1],L.impactedColor).drawColumn(h[0],L.impactedColor).drawGroup(O[0],O[1],L.impactedColor).drawCell(h[0],h[1],this._cellSize,L.thinLineColor,L.selectedColor),this}}function w(){const h=new WebSocket(`ws://${location.host}`);h.onopen=()=>setInterval(()=>h.send("ping"),5000),h.onmessage=(O)=>{if(O.data!=="Well received")console.log(O.data);if(O.data==="reload")location.reload()}}class Z{_values;constructor(h=[]){this._values=new Set(h)}add(h){this._values.add(h)}del(h){this._values.delete(h)}has(h){return this._values.has(h)}copy(){return new Z(this.toJSON())}toJSON(){const h=[];for(let O of this._values)h.push(O);return h}static validateJSON(h){if(Array.isArray(h)&&h.length>0){const O=typeof h[0];if(!h.reduce((B,A)=>B&&typeof A!==O,!0))return!1}return!0}static fromJSON(h){if(Z.validateJSON(h))return new Z(h);throw new Error("At least one element do not have the same type as the other")}}class H{h;_value;constructor(h){this._domain=h}get domain(){return this._domain}get value(){return this._value}set(h){if(this._domain.has(h))this._value=h}unset(){this._value=void 0}isSet(){return typeof this._value!=="undefined"}toJSON(){const h={domain:this._domain.toJSON()};if(this.isSet())h.value=this._value;return h}static fromJSON(h){if(typeof h==="object"&&("domain"in h)&&Z.validateJSON(h.domain)){const q=new Z(h.domain);return new H(q)}throw new Error(`Unexpected JSONVariable object: ${JSON.stringify(h)}`)}}var g=function(h){const O=document.getElementById(h);if(O===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const q=L.get(O);if(!q)return!1;const B=[],A=new Z([1,2,3,4,5,6,7,8,9]);for(let N=0;N<9;N++){B.push([]);for(let R=0;R<9;R++)console.log(A.copy()),console.log(new H(A.copy())),B[N].push(new H(A.copy()))}return{canvas:O,ui:q,cellValues:B}},z=function(h){const{canvas:O,ui:q,cellValues:B}=h;let A=null;function N(E,K){if(B[K][E].value!==void 0&&B[K][E].value)q.drawCellValue(E,K,B[K][E].value);else q.drawCellDomain(E,K,B[K][E].domain)}function R(){for(let E=0;E<9;E++)for(let K=0;K<9;K++)N(K,E)}function F(E,K,Q){B[K][E].domain.del(Q)}function W(E,K,Q){B[K][E].domain.add(Q)}function X(E,K,Q,T){const $=T?F:W;for(let Y=0;Y<9;Y++){if(Y!==E)$(Y,K,Q);if(Y!==K)$(E,Y,Q)}const x=Math.floor(E/3),G=Math.floor(K/3);for(let Y=0;Y<3;Y++)for(let y=0;y<3;y++){const _=x*3+y,J=G*3+Y;if(_!==E&&J!==K)$(_,J,Q)}}function M(E){const K=A[0],Q=A[1];if(B[Q][K].value===void 0||!B[Q][K].value){if(B[Q][K].domain.has(E))B[Q][K].set(E),X(K,Q,E,!0),P()}else if(B[Q][K].value===E){B[Q][K].unset(),X(K,Q,E,!1);for(let T=0;T<9;T++)for(let $=0;$<9;$++)if(B[T][$].value===E)X($,T,E,!0);P()}}function P(){q.drawEmptyGrid().colorizeSelectedStuff(A),R()}b({canvas:O,ui:q,refreshGrid:P,toggle:M,getSelectedCell:()=>A,setSelectedCell:(E)=>A=E}),w(),P()},f=g("sudokuCanvas");if(f)z(f);
