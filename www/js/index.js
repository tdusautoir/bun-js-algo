function g(B){function h(E){E.stopPropagation();const{offsetX:R,offsetY:Y}=E,b=Math.min(Math.floor(R/B.ui.cellSize),8),Z=Math.min(Math.floor(Y/B.ui.cellSize),8),H=B.getSelectedCell();if(H===null||H[0]!==b||H[1]!==Z)B.setSelectedCell([b,Z]),B.refreshGrid()}function q(E){if(E.stopPropagation(),B.getSelectedCell()!==null)B.setSelectedCell(null),B.refreshGrid()}function Q(E){if(E.stopPropagation(),E.key>="1"&&E.key<="9"&&B.getSelectedCell()!==null)B.toggle(parseInt(E.key))}B.canvas.addEventListener("mousemove",h),B.canvas.addEventListener("mouseout",q),document.onkeyup=Q}class W{B;h;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(B){if(W._uis.has(B))return W._uis.get(B);const h=B.getContext("2d");if(h===null)return!1;const q=new W(B,h);return W._uis.set(B,q),q}_cellSize;constructor(B,h){this._canvas=B;this._ctx=h;this._cellSize=Math.round(Math.min(B.width,B.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=W.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(B,h,q=this._cellSize,Q=W.thinLineColor,E){const R=B*q,Y=h*q;if(E)this._ctx.fillStyle=E,this._ctx.fillRect(R+1,Y+1,q-2,q-2);return this._ctx.strokeStyle=Q,this._ctx.strokeRect(R,Y,q,q),this}drawRow(B,h){for(let q=0;q<9;q++)this.drawCell(q,B,this._cellSize,W.thinLineColor,h);return this}drawColumn(B,h){for(let q=0;q<9;q++)this.drawCell(B,q,this._cellSize,W.thinLineColor,h);return this}drawGroup(B,h,q){this.drawCell(B,h,this._cellSize*3,W.boldLineColor,q);for(let Q=0;Q<3;Q++)for(let E=0;E<3;E++)this.drawCell(B*3+E,h*3+Q,this._cellSize,W.thinLineColor);return this}drawCellValue(B,h,q){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const Q=B*this._cellSize+Math.floor(this._cellSize*0.5),E=h*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(q.toString(),Q,E),this}drawCellDomain(B,h,q){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const Q=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),E=Math.floor(Q/3),R=Math.max(1,Math.floor(this._cellSize*0.1)),Y=B*this._cellSize+R,b=h*this._cellSize+R;for(let Z=1;Z<=9;Z++){const H=q.includes(Z)?Z:null,T=(Z-1)%3,_=Math.floor((Z-1)/3),M=Y+E*T,K=b+E*_;this._ctx.fillText(H!==null?H.toString():"",M,K)}return this}drawEmptyGrid(){this.clearCanvas();for(let B=0;B<3;B++)for(let h=0;h<3;h++)this.drawGroup(h,B);return this}colorizeSelectedStuff(B){if(B===null)return this;const h=[Math.floor(B[0]/3),Math.floor(B[1]/3)];return this.drawRow(B[1],W.impactedColor).drawColumn(B[0],W.impactedColor).drawGroup(h[0],h[1],W.impactedColor).drawCell(B[0],B[1],this._cellSize,W.thinLineColor,W.selectedColor),this}}function G(){const B=new WebSocket(`ws://${location.host}`);B.onopen=()=>setInterval(()=>B.send("ping"),5000),B.onmessage=(h)=>{if(h.data!=="Well received")console.log(h.data);if(h.data==="reload")location.reload()}}var x=function(B,h){const q=B.indexOf(h);if(q!==-1)B.splice(q,1);return B},z=function(B,h){if(B.indexOf(h)===-1)B.push(h);return B},J=function(B,h){return B.indexOf(h)!==-1};var y=function(B){const h=document.getElementById(B);if(h===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const q=W.get(h);if(!q)return!1;const Q=[],E=[];for(let R=0;R<9;R++){Q.push([]),E.push([]);for(let Y=0;Y<9;Y++)Q[R].push([1,2,3,4,5,6,7,8,9]),E[R].push(null)}return{canvas:h,ui:q,cellDomains:Q,cellValues:E}},V=function(B){const{canvas:h,ui:q,cellDomains:Q,cellValues:E}=B;let R=null;function Y(K,L){if(E[L][K]!==null)q.drawCellValue(K,L,E[L][K]);else q.drawCellDomain(K,L,Q[L][K])}function b(){for(let K=0;K<9;K++)for(let L=0;L<9;L++)Y(L,K)}function Z(K,L,X){const $=Q[L][K];x($,X)}function H(K,L,X){const $=Q[L][K];z($,X)}function T(K,L,X,$){const P=$?Z:H;for(let A=0;A<9;A++){if(A!==K)P(A,L,X);if(A!==L)P(K,A,X)}const O=Math.floor(K/3),f=Math.floor(L/3);for(let A=0;A<3;A++)for(let F=0;F<3;F++){const N=O*3+F,w=f*3+A;if(N!==K&&w!==L)P(N,w,X)}}function _(K){const L=R[0],X=R[1];if(E[X][L]===null){if(J(Q[X][L],K))E[X][L]=K,T(L,X,K,!0),M()}else if(E[X][L]===K){E[X][L]=null,T(L,X,K,!1);for(let $=0;$<9;$++)for(let P=0;P<9;P++)if(E[$][P]===K)T(P,$,K,!0);M()}}function M(){q.drawEmptyGrid().colorizeSelectedStuff(R),b()}g({canvas:h,ui:q,refreshGrid:M,toggle:_,getSelectedCell:()=>R,setSelectedCell:(K)=>R=K}),G(),M()},D=y("sudokuCanvas");if(D)V(D);
